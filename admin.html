<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת ניהול תוכן - יוניסטרים</title>
    <style>
        body {
            font-family: Assistant, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
            direction: rtl;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            background: linear-gradient(45deg, #007bff, #00bcd4);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .admin-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 20px;
        }

        .nav-button {
            padding: 12px 24px;
            background: linear-gradient(45deg, #007bff, #00bcd4);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }

        .nav-button.active {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .edit-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-right: 5px solid #007bff;
        }

        .edit-form {
            display: grid;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 10px rgba(0,123,255,0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #007bff, #00bcd4);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #ff9800);
        }

        .content-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
        }

        .content-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-right: 4px solid #007bff;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .content-item h4 {
            margin: 0 0 8px 0;
            color: #007bff;
        }

        .content-item p {
            margin: 0;
            color: #666;
            font-size: 0.9em;
        }

        .content-actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .image-upload {
            border: 2px dashed #007bff;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-upload:hover {
            background: #f0f7ff;
        }

        .image-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
        }

        .quiz-question-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .option-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 8px 0;
        }

        .option-input input[type="radio"] {
            margin-left: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .backup-section {
            background: #e8f4ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #007bff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛠️ מערכת ניהול תוכן</h1>
            <p>ניהול מתקדם של המדריך ומערכת הבחינות</p>
        </div>

        <div class="admin-nav">
            <button class="nav-button active" onclick="showSection('content')">ניהול תוכן</button>
            <button class="nav-button" onclick="showSection('quiz')">ניהול בחינות</button>
            <button class="nav-button" onclick="showSection('images')">ניהול תמונות</button>
            <button class="nav-button" onclick="showSection('backup')">גיבוי ושחזור</button>
            <button class="nav-button" onclick="showSection('stats')">סטטיסטיקות</button>
        </div>

        <!-- ניהול תוכן -->
        <div id="content" class="admin-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="content-count">0</div>
                    <div class="stat-label">פריטי תוכן</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="category-count">0</div>
                    <div class="stat-label">קטגוריות</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="faq-count">0</div>
                    <div class="stat-label">שאלות נפוצות</div>
                </div>
            </div>

            <div class="edit-card">
                <h3>הוסף נושא חדש</h3>
                <div class="edit-form">
                    <div class="form-group">
                        <label for="new-term">שם הנושא</label>
                        <input type="text" id="new-term" placeholder="לדוגמה: תכנית חדשה">
                    </div>
                    <div class="form-group">
                        <label for="new-definition">הגדרה/תיאור</label>
                        <textarea id="new-definition" placeholder="תיאור מפורט של הנושא..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="new-category">קטגוריה</label>
                        <select id="new-category">
                            <option value="programs">תכניות</option>
                            <option value="events">אירועים</option>
                            <option value="systems">מערכות</option>
                            <option value="documents">טפסים ומסמכים</option>
                            <option value="training">הכשרות והדרכה</option>
                            <option value="mentoring">ליווי ומנטורינג</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-links">קישורים רלוונטיים (אחד בכל שורה)</label>
                        <textarea id="new-links" placeholder="https://example.com|תיאור הקישור"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addNewContent()">הוסף נושא</button>
                </div>
            </div>

            <div class="edit-card">
                <h3>נושאים קיימים</h3>
                <div class="content-list" id="existing-content">
                    <!-- התוכן הקיים יועלה כאן -->
                </div>
            </div>
        </div>

        <!-- ניהול בחינות -->
        <div id="quiz" class="admin-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="quiz-count">0</div>
                    <div class="stat-label">שאלות בבחינה</div>
                </div>
            </div>

            <div class="edit-card">
                <h3>הוסף שאלה חדשה</h3>
                <div class="quiz-question-form">
                    <div class="form-group">
                        <label for="new-question">השאלה</label>
                        <textarea id="new-question" placeholder="מה השם של התכנית החדשה?"></textarea>
                    </div>
                    <div class="form-group">
                        <label>אפשרויות תשובה</label>
                        <div class="option-input">
                            <input type="radio" name="correct-answer" value="0">
                            <input type="text" id="option-1" placeholder="אפשרות 1">
                        </div>
                        <div class="option-input">
                            <input type="radio" name="correct-answer" value="1">
                            <input type="text" id="option-2" placeholder="אפשרות 2">
                        </div>
                        <div class="option-input">
                            <input type="radio" name="correct-answer" value="2">
                            <input type="text" id="option-3" placeholder="אפשרות 3">
                        </div>
                        <div class="option-input">
                            <input type="radio" name="correct-answer" value="3">
                            <input type="text" id="option-4" placeholder="אפשרות 4">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="addNewQuestion()">הוסף שאלה</button>
                </div>
            </div>

            <div class="edit-card">
                <h3>שאלות קיימות</h3>
                <div class="content-list" id="existing-questions">
                    <!-- השאלות הקיימות יועלו כאן -->
                </div>
            </div>
        </div>

        <!-- ניהול תמונות -->
        <div id="images" class="admin-section">
            <div class="edit-card">
                <h3>העלה תמונה חדשה</h3>
                <div class="image-upload" onclick="document.getElementById('image-input').click()">
                    <input type="file" id="image-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    <p>לחץ כאן או גרור תמונה להעלאה</p>
                    <p style="font-size: 0.8em; color: #666;">נתמכים: JPG, PNG, WebP, GIF</p>
                </div>
                <div id="image-preview"></div>
            </div>

            <div class="edit-card">
                <h3>תמונות קיימות</h3>
                <div class="content-list" id="existing-images">
                    <!-- התמונות הקיימות יועלו כאן -->
                </div>
            </div>
        </div>

        <!-- גיבוי ושחזור -->
        <div id="backup" class="admin-section">
            <div class="backup-section">
                <h3>גיבוי ושחזור</h3>
                <p>יצירת גיבוי של כל התוכן ושחזור ממידע גיבוי קיים</p>
                
                <div style="display: flex; gap: 15px; margin: 20px 0;">
                    <button class="btn btn-warning" onclick="createBackup()">צור גיבוי</button>
                    <button class="btn" onclick="document.getElementById('backup-input').click()">שחזר מגיבוי</button>
                    <input type="file" id="backup-input" accept=".json" style="display: none;" onchange="restoreBackup(event)">
                </div>

                <div id="backup-status"></div>
            </div>

            <div class="edit-card">
                <h3>פרסום אוטומטי</h3>
                <p>פרסום השינויים באתר ובגיטהאב באופן אוטומטי</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0;">
                    <button class="btn btn-success" onclick="publishChanges()">פרסם שינויים מקומית</button>
                    <button class="btn btn-warning" onclick="publishToGitHub()">פרסם לגיטהאב</button>
                    <button class="btn" onclick="publishToGitHubCustom()">פרסם עם הודעה מותאמת</button>
                </div>
                <div id="publish-status"></div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4>🎯 איך זה עובד:</h4>
                    <ol style="text-align: right; margin: 10px 0;">
                        <li><strong>פרסם שינויים מקומית:</strong> עדכון הקבצים במחשב שלך (index.html, quiz.html)</li>
                        <li><strong>פרסם לגיטהאב:</strong> יציג לך את הפקודות להעלאה לגיטהאב</li>
                        <li><strong>פרסם עם הודעה מותאמת:</strong> יציג פקודה עם ההודעה שלך</li>
                    </ol>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 15px; color: #856404;">
                        <strong>⚠️ הערה:</strong> אם זו הפעם הראשונה שלך, <a href="quick-setup.html" target="_blank" style="color: #007bff;">לחץ כאן להגדרה מהירה</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- סטטיסטיקות -->
        <div id="stats" class="admin-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-visits">0</div>
                    <div class="stat-label">סה"כ ביקורים</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="quiz-attempts">0</div>
                    <div class="stat-label">ניסיונות בחינה</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-score">0%</div>
                    <div class="stat-label">ציון ממוצע</div>
                </div>
            </div>

            <div class="edit-card">
                <h3>נתוני שימוש</h3>
                <canvas id="usage-chart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Modal לעריכה -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 id="modal-title">ערוך פריט</h3>
            <div id="modal-form">
                <!-- תוכן הטופס יועלה כאן -->
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div>טוען...</div>
    </div>

    <script>
        // משתנים גלובליים
        let contentData = [];
        let quizData = [];
        let currentEditItem = null;

        // טעינת הדף
        document.addEventListener('DOMContentLoaded', function() {
            loadExistingContent();
            loadExistingQuestions();
            updateStats();
        });

        // החלפת תצוגות
        function showSection(sectionName) {
            // הסתר את כל הסקציות
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // הסר מחלקת active מכל הכפתורים
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // הצג את הסקציה הנבחרת
            document.getElementById(sectionName).classList.add('active');
            
            // הוסף מחלקת active לכפתור הנבחר
            event.target.classList.add('active');
        }

        // טעינת תוכן קיים
        function loadExistingContent() {
            // בדיקה אם יש נתונים שמורים ב-localStorage
            const savedContent = localStorage.getItem('unistream-content');
            if (savedContent) {
                contentData = JSON.parse(savedContent);
                displayExistingContent();
            } else {
                // אם אין נתונים שמורים, נטען מהקובץ הקיים
                parseExistingHTML();
            }
        }

        // ניתוח HTML קיים
        function parseExistingHTML() {
            // כאן נוכל לטעון את הנתונים מהקובץ הקיים
            // לצורך הדוגמא נשתמש בנתונים דמה
            contentData = [
                {
                    id: 1,
                    term: "Edventure",
                    definition: "תכנית הדגל של יוניסטרים, תכנית תלת שנתית...",
                    category: "programs",
                    links: ["https://example.com|צפה בסילבוס התכנית"]
                },
                {
                    id: 2,
                    term: "Salesforce",
                    definition: "מערכת לתיעוד מפגשים, רישום ומעקב נוכחות חניכים...",
                    category: "systems",
                    links: ["https://salesforce.com|כניסה למערכת"]
                }
            ];
            displayExistingContent();
        }

        // הצגת תוכן קיים
        function displayExistingContent() {
            const container = document.getElementById('existing-content');
            container.innerHTML = '';
            
            contentData.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'content-item';
                itemDiv.innerHTML = `
                    <div>
                        <h4>${item.term}</h4>
                        <p>${item.definition.substring(0, 100)}...</p>
                        <small>קטגוריה: ${getCategoryName(item.category)}</small>
                    </div>
                    <div class="content-actions">
                        <button class="btn btn-sm" onclick="editContent(${item.id})">ערוך</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteContent(${item.id})">מחק</button>
                    </div>
                `;
                container.appendChild(itemDiv);
            });
        }

        // קבלת שם קטגוריה בעברית
        function getCategoryName(category) {
            const categories = {
                'programs': 'תכניות',
                'events': 'אירועים', 
                'systems': 'מערכות',
                'documents': 'טפסים ומסמכים',
                'training': 'הכשרות והדרכה',
                'mentoring': 'ליווי ומנטורינג'
            };
            return categories[category] || category;
        }

        // הוספת נושא חדש
        function addNewContent() {
            const term = document.getElementById('new-term').value;
            const definition = document.getElementById('new-definition').value;
            const category = document.getElementById('new-category').value;
            const links = document.getElementById('new-links').value;
            
            if (!term || !definition) {
                showMessage('אנא מלא את כל השדות הנדרשים', 'error');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                term: term,
                definition: definition,
                category: category,
                links: links.split('\n').filter(link => link.trim())
            };
            
            contentData.push(newItem);
            saveContent();
            displayExistingContent();
            updateStats();
            
            // נקה את הטופס
            document.getElementById('new-term').value = '';
            document.getElementById('new-definition').value = '';
            document.getElementById('new-links').value = '';
            
            showMessage('הנושא נוסף בהצלחה!', 'success');
        }

        // עריכת תוכן
        function editContent(id) {
            const item = contentData.find(item => item.id === id);
            if (!item) return;
            
            currentEditItem = id;
            document.getElementById('modal-title').textContent = 'ערוך נושא';
            document.getElementById('modal-form').innerHTML = `
                <div class="form-group">
                    <label>שם הנושא</label>
                    <input type="text" id="edit-term" value="${item.term}">
                </div>
                <div class="form-group">
                    <label>הגדרה/תיאור</label>
                    <textarea id="edit-definition">${item.definition}</textarea>
                </div>
                <div class="form-group">
                    <label>קטגוריה</label>
                    <select id="edit-category">
                        <option value="programs" ${item.category === 'programs' ? 'selected' : ''}>תכניות</option>
                        <option value="events" ${item.category === 'events' ? 'selected' : ''}>אירועים</option>
                        <option value="systems" ${item.category === 'systems' ? 'selected' : ''}>מערכות</option>
                        <option value="documents" ${item.category === 'documents' ? 'selected' : ''}>טפסים ומסמכים</option>
                        <option value="training" ${item.category === 'training' ? 'selected' : ''}>הכשרות והדרכה</option>
                        <option value="mentoring" ${item.category === 'mentoring' ? 'selected' : ''}>ליווי ומנטורינג</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>קישורים רלוונטיים</label>
                    <textarea id="edit-links">${item.links ? item.links.join('\n') : ''}</textarea>
                </div>
                <button class="btn btn-success" onclick="saveEditedContent()">שמור שינויים</button>
            `;
            
            document.getElementById('edit-modal').style.display = 'block';
        }

        // שמירת תוכן ערוך
        function saveEditedContent() {
            const term = document.getElementById('edit-term').value;
            const definition = document.getElementById('edit-definition').value;
            const category = document.getElementById('edit-category').value;
            const links = document.getElementById('edit-links').value;
            
            const itemIndex = contentData.findIndex(item => item.id === currentEditItem);
            if (itemIndex !== -1) {
                contentData[itemIndex] = {
                    ...contentData[itemIndex],
                    term: term,
                    definition: definition,
                    category: category,
                    links: links.split('\n').filter(link => link.trim())
                };
                
                saveContent();
                displayExistingContent();
                closeModal();
                showMessage('השינויים נשמרו בהצלחה!', 'success');
            }
        }

        // מחיקת תוכן
        function deleteContent(id) {
            if (confirm('האם אתה בטוח שברצונך למחוק נושא זה?')) {
                contentData = contentData.filter(item => item.id !== id);
                saveContent();
                displayExistingContent();
                updateStats();
                showMessage('הנושא נמחק בהצלחה!', 'success');
            }
        }

        // טעינת שאלות קיימות
        function loadExistingQuestions() {
            const savedQuestions = localStorage.getItem('unistream-quiz');
            if (savedQuestions) {
                quizData = JSON.parse(savedQuestions);
            } else {
                // נתונים דמה לדוגמא
                quizData = [
                    {
                        id: 1,
                        question: "מהי תכנית NEXTREAM?",
                        options: ["תכנית א'", "תכנית פיילוט", "תכנית ג'", "תכנית ד'"],
                        correct: 1
                    }
                ];
            }
            displayExistingQuestions();
        }

        // הצגת שאלות קיימות
        function displayExistingQuestions() {
            const container = document.getElementById('existing-questions');
            container.innerHTML = '';
            
            quizData.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'content-item';
                itemDiv.innerHTML = `
                    <div>
                        <h4>${item.question}</h4>
                        <p>תשובה נכונה: ${item.options[item.correct]}</p>
                    </div>
                    <div class="content-actions">
                        <button class="btn btn-sm" onclick="editQuestion(${item.id})">ערוך</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteQuestion(${item.id})">מחק</button>
                    </div>
                `;
                container.appendChild(itemDiv);
            });
        }

        // הוספת שאלה חדשה
        function addNewQuestion() {
            const question = document.getElementById('new-question').value;
            const option1 = document.getElementById('option-1').value;
            const option2 = document.getElementById('option-2').value;
            const option3 = document.getElementById('option-3').value;
            const option4 = document.getElementById('option-4').value;
            const correctAnswer = document.querySelector('input[name="correct-answer"]:checked');
            
            if (!question || !option1 || !option2 || !option3 || !option4 || !correctAnswer) {
                showMessage('אנא מלא את כל השדות ובחר תשובה נכונה', 'error');
                return;
            }
            
            const newQuestion = {
                id: Date.now(),
                question: question,
                options: [option1, option2, option3, option4],
                correct: parseInt(correctAnswer.value)
            };
            
            quizData.push(newQuestion);
            saveQuestions();
            displayExistingQuestions();
            updateStats();
            
            // נקה את הטופס
            document.getElementById('new-question').value = '';
            document.getElementById('option-1').value = '';
            document.getElementById('option-2').value = '';
            document.getElementById('option-3').value = '';
            document.getElementById('option-4').value = '';
            document.querySelector('input[name="correct-answer"]:checked').checked = false;
            
            showMessage('השאלה נוספה בהצלחה!', 'success');
        }

        // עריכת שאלה
        function editQuestion(id) {
            const item = quizData.find(item => item.id === id);
            if (!item) return;
            
            currentEditItem = id;
            document.getElementById('modal-title').textContent = 'ערוך שאלה';
            document.getElementById('modal-form').innerHTML = `
                <div class="form-group">
                    <label>השאלה</label>
                    <textarea id="edit-question">${item.question}</textarea>
                </div>
                <div class="form-group">
                    <label>אפשרויות תשובה</label>
                    ${item.options.map((option, index) => `
                        <div class="option-input">
                            <input type="radio" name="edit-correct-answer" value="${index}" ${item.correct === index ? 'checked' : ''}>
                            <input type="text" id="edit-option-${index}" value="${option}">
                        </div>
                    `).join('')}
                </div>
                <button class="btn btn-success" onclick="saveEditedQuestion()">שמור שינויים</button>
            `;
            
            document.getElementById('edit-modal').style.display = 'block';
        }

        // שמירת שאלה ערוכה
        function saveEditedQuestion() {
            const question = document.getElementById('edit-question').value;
            const option0 = document.getElementById('edit-option-0').value;
            const option1 = document.getElementById('edit-option-1').value;
            const option2 = document.getElementById('edit-option-2').value;
            const option3 = document.getElementById('edit-option-3').value;
            const correctAnswer = document.querySelector('input[name="edit-correct-answer"]:checked');
            
            const itemIndex = quizData.findIndex(item => item.id === currentEditItem);
            if (itemIndex !== -1) {
                quizData[itemIndex] = {
                    ...quizData[itemIndex],
                    question: question,
                    options: [option0, option1, option2, option3],
                    correct: parseInt(correctAnswer.value)
                };
                
                saveQuestions();
                displayExistingQuestions();
                closeModal();
                showMessage('השאלה עודכנה בהצלחה!', 'success');
            }
        }

        // מחיקת שאלה
        function deleteQuestion(id) {
            if (confirm('האם אתה בטוח שברצונך למחוק שאלה זו?')) {
                quizData = quizData.filter(item => item.id !== id);
                saveQuestions();
                displayExistingQuestions();
                updateStats();
                showMessage('השאלה נמחקה בהצלחה!', 'success');
            }
        }

        // טיפול בהעלאת תמונות
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('image-preview');
                preview.innerHTML = `
                    <img src="${e.target.result}" class="image-preview" alt="תצוגה מקדימה">
                    <div>
                        <input type="text" placeholder="תיאור התמונה" id="image-description" style="width: 100%; margin: 10px 0; padding: 8px;">
                        <button class="btn btn-success" onclick="saveImage('${e.target.result}')">שמור תמונה</button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        // שמירת תמונה
        function saveImage(dataUrl) {
            const description = document.getElementById('image-description').value;
            const images = JSON.parse(localStorage.getItem('unistream-images') || '[]');
            
            const newImage = {
                id: Date.now(),
                url: dataUrl,
                description: description,
                uploadDate: new Date().toISOString()
            };
            
            images.push(newImage);
            localStorage.setItem('unistream-images', JSON.stringify(images));
            
            document.getElementById('image-preview').innerHTML = '';
            document.getElementById('image-input').value = '';
            showMessage('התמונה נשמרה בהצלחה!', 'success');
            displayExistingImages();
        }

        // הצגת תמונות קיימות
        function displayExistingImages() {
            const images = JSON.parse(localStorage.getItem('unistream-images') || '[]');
            const container = document.getElementById('existing-images');
            container.innerHTML = '';
            
            images.forEach(image => {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'content-item';
                imageDiv.innerHTML = `
                    <div>
                        <img src="${image.url}" style="width: 100px; height: auto; border-radius: 4px;">
                        <p>${image.description}</p>
                        <small>הועלתה: ${new Date(image.uploadDate).toLocaleDateString('he-IL')}</small>
                    </div>
                    <div class="content-actions">
                        <button class="btn btn-sm" onclick="copyImageUrl('${image.url}')">העתק קישור</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteImage(${image.id})">מחק</button>
                    </div>
                `;
                container.appendChild(imageDiv);
            });
        }

        // העתקת קישור תמונה
        function copyImageUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                showMessage('קישור התמונה הועתק ללוח!', 'success');
            });
        }

        // מחיקת תמונה
        function deleteImage(id) {
            if (confirm('האם אתה בטוח שברצונך למחוק תמונה זו?')) {
                const images = JSON.parse(localStorage.getItem('unistream-images') || '[]');
                const updatedImages = images.filter(image => image.id !== id);
                localStorage.setItem('unistream-images', JSON.stringify(updatedImages));
                displayExistingImages();
                showMessage('התמונה נמחקה בהצלחה!', 'success');
            }
        }

        // יצירת גיבוי
        function createBackup() {
            const backupData = {
                content: contentData,
                quiz: quizData,
                images: JSON.parse(localStorage.getItem('unistream-images') || '[]'),
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `unistream-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showMessage('גיבוי נוצר בהצלחה!', 'success');
        }

        // שחזור מגיבוי
        function restoreBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (backupData.content) {
                        contentData = backupData.content;
                        localStorage.setItem('unistream-content', JSON.stringify(contentData));
                        displayExistingContent();
                    }
                    
                    if (backupData.quiz) {
                        quizData = backupData.quiz;
                        localStorage.setItem('unistream-quiz', JSON.stringify(quizData));
                        displayExistingQuestions();
                    }
                    
                    if (backupData.images) {
                        localStorage.setItem('unistream-images', JSON.stringify(backupData.images));
                        displayExistingImages();
                    }
                    
                    updateStats();
                    showMessage('השחזור הושלם בהצלחה!', 'success');
                } catch (error) {
                    showMessage('שגיאה בקריאת קובץ הגיבוי', 'error');
                }
            };
            reader.readAsText(file);
        }

        // פרסום שינויים מקומית
        function publishChanges() {
            showLoading(true);
            document.getElementById('publish-status').innerHTML = '<div class="success-message">מפרסם שינויים מקומית...</div>';
            
            // סימולציה של פרסום - כאן אפשר להוסיף קוד לעדכון הקבצים בפועל
            setTimeout(() => {
                showLoading(false);
                document.getElementById('publish-status').innerHTML = '<div class="success-message">השינויים פורסמו במחשב שלך! 🎉<br><small>כעת תוכל לפרסם לגיטהאב כדי שהאתר יתעדכן</small></div>';
                
                // כאן נוכל להוסיף קוד לעדכון הקבצים בפועל
                updateActualFiles();
            }, 2000);
        }

        // פרסום אוטומטי לגיטהאב
        async function publishToGitHub() {
            showLoading(true);
            document.getElementById('publish-status').innerHTML = '<div class="success-message">מפרסם לגיטהאב...</div>';
            
            try {
                // בדיקה אם אנחנו בסביבת פיתוח
                if (window.location.protocol === 'file:') {
                    showLoading(false);
                    document.getElementById('publish-status').innerHTML = `
                        <div class="info-box" style="background: #e8f4ff; border: 1px solid #b8daff; padding: 15px; border-radius: 8px;">
                            <h4>📋 כך תפרסם לגיטהאב:</h4>
                            <p><strong>אופציה 1 - הכי קל:</strong> לחץ לחיצה כפולה על הקובץ:</p>
                            <div style="background: #2d3748; color: #48bb78; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace; text-align: center;">
                                publish.bat
                            </div>
                            <p><strong>אופציה 2 - בטרמינל:</strong></p>
                            <div style="background: #2d3748; color: #48bb78; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace;">
                                npm run update
                            </div>
                            <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px; color: #856404;">
                                <strong>🔧 פעם ראשונה?</strong> <a href="quick-setup.html" target="_blank" style="color: #007bff;">לחץ כאן להגדרה מהירה</a>
                            </div>
                        </div>
                    `;
                    return;
                }

                // ניסיון לבצע פרסום באמצעות API
                const response = await fetch('/api/git-publish', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        type: 'auto',
                        message: `עדכון תוכן - ${new Date().toLocaleDateString('he-IL')} ${new Date().toLocaleTimeString('he-IL')}`
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showLoading(false);
                    document.getElementById('publish-status').innerHTML = '<div class="success-message">פורסם לגיטהאב בהצלחה! 🚀<br><small>האתר יתעדכן בעוד כמה דקות</small></div>';
                } else {
                    throw new Error('שגיאה בפרסום');
                }
            } catch (error) {
                showLoading(false);
                document.getElementById('publish-status').innerHTML = `
                    <div class="error-message">
                        <h4>פרסום ידני נדרש</h4>
                        <p>לחץ על קובץ publish.bat או הרץ בטרמינל:</p>
                        <div style="background: #2d3748; color: #48bb78; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace;">
                            npm run publish
                        </div>
                    </div>
                `;
            }
        }

        // פרסום לגיטהאב עם הודעה מותאמת
        async function publishToGitHubCustom() {
            const message = prompt('הכנס הודעת commit:', 'עדכון תוכן');
            if (!message) return;

            showLoading(true);
            document.getElementById('publish-status').innerHTML = '<div class="success-message">מפרסם לגיטהאב עם ההודעה שלך...</div>';
            
            try {
                if (window.location.protocol === 'file:') {
                    showLoading(false);
                    document.getElementById('publish-status').innerHTML = `
                        <div class="info-box" style="background: #e8f4ff; border: 1px solid #b8daff; padding: 15px; border-radius: 8px;">
                            <h4>📋 פרסום עם ההודעה שלך:</h4>
                            <p><strong>אופציה 1:</strong> לחץ לחיצה כפולה על:</p>
                            <div style="background: #2d3748; color: #48bb78; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace; text-align: center;">
                                publish-custom.bat
                            </div>
                            <p><strong>אופציה 2:</strong> בטרמינל הרץ:</p>
                            <div style="background: #2d3748; color: #48bb78; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace;">
                                node publish.js "${message}"
                            </div>
                        </div>
                    `;
                    return;
                }

                const response = await fetch('/api/git-publish', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        type: 'custom',
                        message: message
                    })
                });

                if (response.ok) {
                    showLoading(false);
                    document.getElementById('publish-status').innerHTML = '<div class="success-message">פורסם לגיטהאב בהצלחה! 🚀<br><small>האתר יתעדכן בעוד כמה דקות</small></div>';
                } else {
                    throw new Error('שגיאה בפרסום');
                }
            } catch (error) {
                showLoading(false);
                document.getElementById('publish-status').innerHTML = `
                    <div class="error-message">
                        <h4>פרסום ידני נדרש</h4>
                        <p>הרץ בטרמינל:</p>
                        <div style="background: #2d3748; color: #48bb78; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace;">
                            node publish.js "${message}"
                        </div>
                    </div>
                `;
            }
        }

        // עדכון קבצים בפועל
        function updateActualFiles() {
            // כאן נוכל להשתמש ב-MCP כדי לעדכן את הקבצים בפועל
            // לדוגמא: עדכון index.html עם התוכן החדש
            generateUpdatedHTML();
        }

        // יצירת HTML מעודכן
        function generateUpdatedHTML() {
            // כאן נוכל לבנות את ה-HTML החדש בהתבסס על הנתונים המעודכנים
            console.log('מעדכן קבצי HTML...');
        }

        // עדכון סטטיסטיקות
        function updateStats() {
            document.getElementById('content-count').textContent = contentData.length;
            document.getElementById('quiz-count').textContent = quizData.length;
            
            // חישוב קטגוריות
            const categories = [...new Set(contentData.map(item => item.category))];
            document.getElementById('category-count').textContent = categories.length;
            
            // ספירת שאלות FAQ
            const faqCount = contentData.filter(item => item.category === 'faq').length;
            document.getElementById('faq-count').textContent = faqCount;
        }

        // שמירת תוכן
        function saveContent() {
            localStorage.setItem('unistream-content', JSON.stringify(contentData));
        }

        // שמירת שאלות
        function saveQuestions() {
            localStorage.setItem('unistream-quiz', JSON.stringify(quizData));
        }

        // סגירת מודל
        function closeModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        // הצגת הודעות
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // הצגת טעינה
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // סגירת מודל בלחיצה מחוץ לו
        window.onclick = function(event) {
            const modal = document.getElementById('edit-modal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>